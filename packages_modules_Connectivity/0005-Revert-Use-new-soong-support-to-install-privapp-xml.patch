From 6015f6f189ead6c3c65c7a8ad546092735090f17 Mon Sep 17 00:00:00 2001
From: Yaroslav Zviezda <acroreiser@gmail.com>
Date: Mon, 1 Apr 2024 22:49:41 +0300
Subject: [PATCH 05/17] Revert "Use new soong support to install privapp xml"

This reverts commit 1397a101accae6318eb8d01ed2a22ecc2c136cdb.

Change-Id: If10ecaac944d67a3cc154d1363a71c74928509c4
---
 Tethering/Android.bp                  | 4 ++--
 Tethering/apex/Android.bp             | 3 ++-
 Tethering/apex/permissions/Android.bp | 7 +++++--
 3 files changed, 9 insertions(+), 5 deletions(-)

diff --git a/Tethering/Android.bp b/Tethering/Android.bp
index 2735c16174..0538a0d00e 100644
--- a/Tethering/Android.bp
+++ b/Tethering/Android.bp
@@ -201,7 +201,7 @@ android_app {
     certificate: "networkstack",
     manifest: "AndroidManifest.xml",
     use_embedded_native_libs: true,
-    privapp_allowlist: ":privapp_allowlist_com.android.tethering",
+    required: ["privapp_allowlist_com.android.tethering"],
     apex_available: ["com.android.tethering"],
     lint: { strict_updatability_linting: true },
 }
@@ -217,7 +217,7 @@ android_app {
     certificate: "networkstack",
     manifest: "AndroidManifest.xml",
     use_embedded_native_libs: true,
-    privapp_allowlist: ":privapp_allowlist_com.android.tethering",
+    required: ["privapp_allowlist_com.android.tethering"],
     apex_available: ["com.android.tethering"],
     lint: {
         strict_updatability_linting: true,
diff --git a/Tethering/apex/Android.bp b/Tethering/apex/Android.bp
index 29c0132701..a1e4bd62f7 100644
--- a/Tethering/apex/Android.bp
+++ b/Tethering/apex/Android.bp
@@ -125,8 +125,9 @@ apex {
     ],
     prebuilts: [
         "ot-daemon.init.34rc",
-        "current_sdkinfo",
         "TetheringOutOfProcessFlag",
+        "current_sdkinfo",
+        "privapp_allowlist_com.android.tethering",
     ],
     manifest: "manifest.json",
     key: "com.android.tethering.key",
diff --git a/Tethering/apex/permissions/Android.bp b/Tethering/apex/permissions/Android.bp
index 69c1aa2d4c..ac9ec65dd5 100644
--- a/Tethering/apex/permissions/Android.bp
+++ b/Tethering/apex/permissions/Android.bp
@@ -19,7 +19,10 @@ package {
     default_visibility: ["//packages/modules/Connectivity/Tethering:__subpackages__"],
 }
 
-filegroup {
+prebuilt_etc {
     name: "privapp_allowlist_com.android.tethering",
-    srcs: ["permissions.xml"],
+    sub_dir: "permissions",
+    filename: "permissions.xml",
+    src: "permissions.xml",
+    installable: false,
 }
\ No newline at end of file
-- 
2.37.2

